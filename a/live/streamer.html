<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>推流端 - 夸克直播间</title>
    <!-- 引入声网Agora SDK -->
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.20.2.js"></script>
    <script src="https://unpkg.com/marked@4.0.0/marked.min.js"></script>
    <link rel="stylesheet" href="css/streamer.css">
</head>

<body>
    <div class="container">
        <div class="main-panel">
            <div class="video-container">
                <div id="preview-placeholder" class="video-placeholder">
                    <i class="fas fa-video"></i>
                    <div>视频预览</div>
                    <div style="font-size: 0.9rem; margin-top: 10px; color: #ccc;">请选择视频源并开始预览</div>
                </div>
                <video id="local-video" class="hidden" autoplay muted playsinline></video>
            </div>

            <div class="video-controls">
                <div class="video-source-selector">
                    <button class="source-btn active" id="camera-source-btn">
                        <i class="fas fa-camera"></i>
                        摄像头
                    </button>
                    <button class="source-btn" id="screen-source-btn">
                        <i class="fas fa-desktop"></i>
                        屏幕共享
                    </button>
                </div>

                <button class="control-btn" id="start-preview-btn">
                    <i class="fas fa-play"></i>
                    开始预览
                </button>

                <button class="control-btn" id="start-btn">
                    <i class="fas fa-broadcast-tower"></i>
                    开始推流
                </button>

                <button class="control-btn" id="stop-btn" disabled>
                    <i class="fas fa-stop"></i>
                    停止推流
                </button>
            </div>
        </div>

        <div class="sidebar">
            <div class="chat-container">
                <div class="chat-header">
                    <h3><i class="fas fa-comments"></i> 实时互动</h3>
                    <div class="message-count">消息: <span id="chat-message-count">0</span></div>
                </div>
                <div class="messages" id="messages">
                    <div class="message">
                        <div class="message-header">
                            <div class="message-avatar" style="background: #4a6cf7">系</div>
                            <span class="user">系统</span>
                            <span class="time" id="current-time"></span>
                        </div>
                        <div class="message-content">直播开始后，观众的消息将显示在这里</div>
                    </div>
                </div>
                <!-- 新增：聊天输入区域 -->
                <div class="chat-input-container">
                    <input type="text" id="chat-message-input" placeholder="输入消息...">
                    <button id="chat-send-btn">发送</button>
                </div>
            </div>

            <div class="config-panel">
                <div class="panel-header">
                    <h3><i class="fas fa-sliders-h"></i> 直播配置</h3>
                </div>

                <div id="error-message" class="error hidden"></div>
                <div id="success-message" class="success hidden"></div>

                <div class="form-group">
                    <label for="stream-title">直播标题</label>
                    <input type="text" id="stream-title" placeholder="请输入直播标题" value="夸克博客直播">
                </div>

                <div class="form-group">
                    <label for="stream-description">直播描述</label>
                    <textarea id="stream-description" placeholder="请输入直播描述">欢迎来到我的直播间！</textarea>
                </div>

                <div class="form-group">
                    <label for="video-source">视频源</label>
                    <select id="video-source">
                        <option value="">选择摄像头</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="audio-source">音频源</label>
                    <select id="audio-source">
                        <option value="">选择麦克风</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="resolution">分辨率</label>
                    <select id="resolution">
                        <option value="480p">640×480 (480p)</option>
                        <option value="720p" selected>1280×720 (720p)</option>
                        <option value="1080p">1920×1080 (1080p)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stream-token">推流Token <span style="color: #ff4757;">*</span></label>
                    <textarea id="stream-token" placeholder="请输入从声网控制台生成的Token" rows="3"></textarea>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                        每次直播都需要重新生成Token。
                        <a href="https://console.shengwang.cn/overview" target="_blank"
                            style="color: var(--secondary-color);">点击这里生成Token</a>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button type="button" class="copy-btn" onclick="fillLastToken()">
                            <i class="fas fa-history"></i>
                            填充上一次
                        </button>
                        <button type="button" class="copy-btn" onclick="clearToken()" style="background: #6c757d;">
                            <i class="fas fa-trash"></i>
                            清空
                        </button>
                    </div>
                </div>

                <div class="status-indicators">
                    <div class="status-item">
                        视频状态
                        <div class="status-value" id="video-status">未连接</div>
                    </div>
                    <div class="status-item">
                        音频状态
                        <div class="status-value" id="audio-status">未连接</div>
                    </div>
                </div>

                <div class="stream-info hidden" id="stream-info-panel">
                    <div class="info-title">
                        <i class="fas fa-info-circle"></i>
                        直播信息
                    </div>
                    <div>观众观看地址:</div>
                    <div class="stream-url" id="viewer-url">https://lsqkk.github.io/a/live/</div>
                    <button class="copy-btn" onclick="copyViewerUrl()">
                        <i class="fas fa-copy"></i>
                        复制观看地址
                    </button>

                    <div style="margin-top: 15px;">频道名称:</div>
                    <div class="stream-url" id="agora-channel">lsqkk</div>
                    <button class="copy-btn" onclick="copyChannelName()">
                        <i class="fas fa-copy"></i>
                        复制频道名
                    </button>
                </div>
            </div>

            <div class="stats-container">
                <div class="panel-header">
                    <h3><i class="fas fa-chart-bar"></i> 直播数据</h3>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="viewer-count">0</div>
                        <div class="stat-label">在线观众</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="like-count">0</div>
                        <div class="stat-label">总点赞数</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="message-count">0</div>
                        <div class="stat-label">聊天消息</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stream-duration">00:00</div>
                        <div class="stat-label">直播时长</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <script src="js/streamer.js"></script>
</body>

</html>