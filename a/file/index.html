<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>点对点文件传输</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="glass-container">
        <!-- 状态指示器 -->
        <div class="status-indicator" id="statusIndicator">
            <div class="dot"></div>
            <span>准备连接</span>
        </div>

        <!-- 连接面板 -->
        <div class="panel" id="connectionPanel">
            <div class="panel-header">
                <h2>点对点文件传输</h2>
                <p class="subtitle">无需服务器，直接传输</p>
            </div>

            <div class="panel-body">
                <div class="id-section">
                    <label>我的ID（分享给对方）</label>
                    <div class="id-display">
                        <code id="myId">正在生成...</code>
                        <button class="icon-btn" onclick="copyMyId()" title="复制">
                            <svg width="16" height="16" fill="currentColor">
                                <path
                                    d="M13 0H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM6 1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z" />
                                <path d="M4 3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1v1a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="divider">
                    <span>或</span>
                </div>

                <div class="connect-section">
                    <label>连接其他设备</label>
                    <div class="input-group">
                        <input type="text" id="peerIdInput" placeholder="输入对方的ID" spellcheck="false">
                        <button id="connectBtn" class="primary-btn">连接</button>
                    </div>
                    <p class="hint">双方需要同时在线才能建立连接</p>
                </div>
            </div>
        </div>

        <!-- 传输面板（初始隐藏） -->
        <div class="panel hidden" id="transferPanel">
            <div class="panel-header">
                <h2>文件传输</h2>
                <p class="connection-info">
                    已连接到：<span id="peerName">未知</span>
                    <button class="text-btn" onclick="disconnect()">断开</button>
                </p>
            </div>

            <div class="panel-body">
                <!-- 文件拖放区域 -->
                <div class="drop-zone" id="dropZone">
                    <div class="drop-content">
                        <svg width="48" height="48" fill="currentColor">
                            <path
                                d="M19.5 14a2.5 2.5 0 0 1 5 0v5.5H25a2.5 2.5 0 0 1 0 5h-5.5V25a2.5 2.5 0 0 1-5 0v-5.5H9.5a2.5 2.5 0 0 1 0-5h5.5V14z" />
                            <path
                                d="M1 4.5A1.5 1.5 0 0 1 2.5 3h21A1.5 1.5 0 0 1 25 4.5v21a1.5 1.5 0 0 1-1.5 1.5h-21A1.5 1.5 0 0 1 1 25.5v-21zm2.5 0v21h21v-21h-21z" />
                        </svg>
                        <h3>拖放文件到此处</h3>
                        <p>支持单个或多个文件，最大100MB</p>
                        <button class="secondary-btn" onclick="document.getElementById('fileInput').click()">
                            选择文件
                        </button>
                        <input type="file" id="fileInput" multiple hidden>
                    </div>
                </div>

                <!-- 传输队列 -->
                <div class="transfer-queue" id="transferQueue"></div>

                <!-- 进度条 -->
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-info">
                        <span id="progressText">等待传输</span>
                        <span id="speedText"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文件列表 -->
        <div class="panel file-list hidden" id="fileList">
            <div class="panel-header">
                <h3>传输历史</h3>
                <button class="text-btn" onclick="clearHistory()">清空</button>
            </div>
            <div class="panel-body" id="historyList">
                <div class="empty-state">暂无传输记录</div>
            </div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script src="app.js"></script>
</body>

</html>