<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è“è‰²å¥‡å¤¸å…‹ã®åšå®¢</title>
    
    <!-- KaTeXæ ·å¼ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo_blue.png" type="image/png">
    <style>
        body { max-width: 800px; margin: 0 auto; padding: 20px; }
        .post-content { 
            line-height: 1.6;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        code { background-color: #f6f8fa; padding: 2px 4px; border-radius: 4px; }
        pre { 
            background-color: #f6f8fa; 
            padding: 16px; 
            overflow: auto;
            border-radius: 6px;
            line-height: 1.45;
        }
        .back-link { display: inline-block; margin-bottom: 20px; }
        .share-button {
            background-color: #99ddf3;
            padding: 5px 10px;
            border-radius: 5px;
            text-decoration: none;
            color: #007bff;
            cursor: pointer;
        }
        .mode-toggle {
            cursor: pointer;
            margin-left: 10px;
            font-size: 24px;
        }
    </style>
</head>
<body style=" background: url('https://lsqkk.github.io/star.gif') no-repeat center center; background-size: cover; position: relative; background-attachment: fixed;">
    <div class="header-placeholder"></div>
    <div class="header">
        <a href="index.html" style="text-decoration: none; color:white;"><h2 style="display: inline;">è“è‰²å¥‡å¤¸å…‹ã®åšå®¢</h2> </a>
        &emsp;&emsp;
        <a href="article-list.html" style="background-color: #99ddf3; padding: 5px 10px; border-radius: 5px; text-decoration: none;color: #007bff; ">è¿”å›åˆ—è¡¨</a>
        <span class="mode-toggle" onclick="toggleMode()">ğŸŒ™</span>
    </div> 
    
    <div class="moren" style="box-shadow: 0 0 10px 10px rgba(255,255,255,0.3);">
        <div id="content" class="post-content"></div>
        <hr>
        <p>æœ¬æ–‡é˜…è¯»é‡: <span id="pageView">0</span> æ¬¡</p>
        <div style="margin-top: 20px;">
            <button class="share-button" onclick="copyLink()">åˆ†äº«æœ¬æ–‡é“¾æ¥</button>
            <span id="copy-notice" style="color: #666; margin-left: 10px; display: none;">é“¾æ¥å·²å¤åˆ¶ï¼</span>
        </div>
    </div>

    <!-- æ˜¾ç¤ºé˜…è¯»é‡ -->


    <script>
        // è·å–å½“å‰ URL å‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const fileParam = urlParams.get('file'); // ä¾‹å¦‚ï¼šxxx.md

        // åˆå§‹åŒ–é˜…è¯»é‡æ•°æ®
        let pageViewData = JSON.parse(localStorage.getItem('pageViewData')) || {};

        // å¦‚æœå½“å‰æ–‡ç« æ²¡æœ‰é˜…è¯»é‡æ•°æ®ï¼Œåˆå§‹åŒ–ä¸º 0
        if (!pageViewData[fileParam]) {
            pageViewData[fileParam] = 0;
        }

        // æ›´æ–°é˜…è¯»é‡
        pageViewData[fileParam] += 1;
        localStorage.setItem('pageViewData', JSON.stringify(pageViewData));

        // æ˜¾ç¤ºé˜…è¯»é‡
        document.getElementById('pageView').innerText = pageViewData[fileParam];
    </script>

    <!-- ä¾èµ–åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script>
        // è·å–URLå‚æ•°
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // è‡ªå®šä¹‰Markdownæ¸²æŸ“å™¨ä»¥ä¿ç•™TeX
        const renderer = {
            code(code, infostring) {
                if (infostring === 'math') {
                    return `<div class="math-block">${code}</div>`;
                }
                return false; // ä½¿ç”¨é»˜è®¤æ¸²æŸ“
            }
        };
        marked.use({ renderer });

        // åŠ è½½æ–‡ç« å†…å®¹
        async function loadPost() {
            const filename = getQueryParam('file');
            if (!filename) {
                document.getElementById('content').innerHTML = '<p>æ–‡ç« æœªæ‰¾åˆ°</p>';
                return;
            }

            try {
                const mdContent = await fetch(`/posts/${filename}`).then(r => r.text());
                const htmlContent = marked.parse(mdContent);
                document.getElementById('content').innerHTML = htmlContent;
                
                // æ¸²æŸ“æ•°å­¦å…¬å¼
                renderMathInElement(document.getElementById('content'), {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false }
                    ],
                    throwOnError: false
                });
            } catch (error) {
                document.getElementById('content').innerHTML = '<p>åŠ è½½æ–‡ç« å¤±è´¥</p>';
            }
        }

        // å¤åˆ¶é“¾æ¥åŠŸèƒ½
        function copyLink() {
            const currentURL = window.location.href;
            navigator.clipboard.writeText(currentURL).then(() => {
                const notice = document.getElementById('copy-notice');
                notice.style.display = 'inline';
                setTimeout(() => notice.style.display = 'none', 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
            });
        }

        // åˆ‡æ¢é»‘æš—/ç™½å¤©æ¨¡å¼
        function toggleMode() {
            const body = document.body;
            const modeToggle = document.querySelector('.mode-toggle');
            const isDarkMode = body.style.backgroundImage.includes('star.gif');

            if (isDarkMode) {
                body.style.backgroundImage = "url('https://lsqkk.github.io/light.gif')";
                modeToggle.innerText = 'â˜€ï¸';
            } else {
                body.style.backgroundImage = "url('https://lsqkk.github.io/star.gif')";
                modeToggle.innerText = 'ğŸŒ™';
            }
        }

        // åˆå§‹åŒ–åŠ è½½
        document.addEventListener('DOMContentLoaded', loadPost);
    </script>

    <div class="moren"><a href="post.html?file=copyright.md" style="text-decoration: none; color: black;">Â© 2025 è“è‰²å¥‡å¤¸å…‹ - ä¸ªäººåšå®¢</a></div>
</body>
</html>
