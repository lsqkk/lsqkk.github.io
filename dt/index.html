<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>夸克动态 | 蓝色奇夸克のBlog</title>
    <base href="https://lsqkk.github.io/">
    <link rel="stylesheet" href="css/cursor.css">
    <link rel="stylesheet" href="css/dt.css">
    <script src="js/cursor-trail.js"></script>
</head>

<body>
    <div class="dynamic-container">
        <div class="dynamic-header">
            <h1>📢 站主动态</h1>
            <p>仅日常分享，开发日志请移步主页 - 最新功能 - 更新日志</p>
        </div>
        <div id="dynamic-content"></div>
        <a href="index.html" class="back-home">← 返回主页</a>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/marked/4.0.0/marked.min.js"></script>

    <script>
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        async function loadDynamic() {
            try {
                const response = await fetch('dt/dt.md');
                const mdContent = await response.text();
                const entries = parseDynamicEntries(mdContent);
                renderDynamicEntries(entries);
            } catch (error) {
                document.getElementById('dynamic-content').innerHTML = `
                    <div class="dynamic-card">
                        <h3>动态加载失败</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function parseDynamicEntries(content) {
            // 使用正则表达式在#前分割（正向先行断言）
            return content.split(/\n(?=# )/g).map(entry => {
                const [header, ...body] = entry.split('\n');
                const titleMatch = header.match(/^# (.*)/);
                const dateMatch = body.join('\n').match(/## 日期：(.+)/);

                return {
                    title: titleMatch ? titleMatch[1].trim() : '未命名动态',
                    date: dateMatch ? dateMatch[1].trim() : '',
                    content: body.join('\n').replace(/## 日期：.+\n?/, '').trim()
                };
            }).filter(entry => entry.title).reverse();
        }
        function renderDynamicEntries(entries) {
            const container = document.getElementById('dynamic-content');
            container.innerHTML = entries.map(entry => `
                <div class="dynamic-card">
                    <h2 class="dynamic-title">${entry.title}</h2>
                    ${entry.date ? `<div class="dynamic-date">📅 ${entry.date}</div>` : ''}
                    <div class="dynamic-content">
                        ${marked.parse(entry.content)}
                    </div>
                </div>
            `).join('');
        }

        window.addEventListener('DOMContentLoaded', loadDynamic);
    </script>
</body>

</html>