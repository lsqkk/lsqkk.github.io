<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DeepSeek - 夸克博客</title>
  <style>
    /* 基础样式 */
    *{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#1e1e2f,#2a2a40);margin:0;color:#fff;overflow-x:hidden}

    #main-container{display:flex;max-width:1200px;margin:0 auto;height:100vh}

    /* 左侧栏样式 */
    #sidebar{
      width:250px;
      background:rgba(0,0,0,0.3);
      border-right:1px solid rgba(255,255,255,0.1);
      padding:20px;
      transition:transform 0.3s ease;
      overflow-y:auto;
      display:flex;flex-direction:column}
    #sidebar.collapsed{transform:translateX(-100%);width:60px}
    #sidebar-toggle{position:absolute;right:-30px;top:20px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;z-index:100;display:block}
    #sidebar-header{margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.1)}
    #history-list{flex:1;overflow-y:auto;max-height:calc(100vh - 200px)}
    .history-item{padding:10px;border-radius:8px;margin-bottom:10px;background:rgba(255,255,255,0.1);cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .history-item:hover{background:rgba(255,255,255,0.2)}
    #new-chat-btn{margin-top:15px;padding:10px;width:100%;background:linear-gradient(135deg,#007bff,#0056b3);color:#fff;border:none;border-radius:8px;cursor:pointer}
    @media(max-width:768px){#sidebar:not(.collapsed){transform:translateX(0);position:absolute;top:0;left:0;bottom:0;z-index:1000}}

    /* 右侧主内容区样式 */
    #chat-container{flex:1;margin:20px;padding:20px;background:rgba(255,255,255,0.1);border-radius:16px;backdrop-filter:blur(10px);box-shadow:0 4px 30px rgba(0,0,0,0.1);display:flex;flex-direction:column;height:100%}
    h1{margin-bottom:20px;font-size:24px;color:#fff}
    #chat-history{flex:1;overflow-y:auto;border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:15px;margin-bottom:15px;background:rgba(255,255,255,0.05);max-height:calc(100vh - 200px)}
    .user-msg,.bot-msg{margin:10px 0;padding:12px;border-radius:12px;position:relative}
    .user-msg{background:rgba(0,123,255,0.1);color:#007bff;margin-left:25%;text-align:right}
    .bot-msg {
    margin-top: 15px;
    position: relative;
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 15px;
}
.copy-btn {
    position: absolute;
    right: 12px;
    bottom: 12px;
    background: rgba(255,255,255,0.15);
    padding: 4px 10px;
    border-radius: 4px;
}
    .think-content{margin-top:10px;padding:10px;background:rgba(255,255,255,0.05);border-radius:8px;border-left:3px solid #007bff;color:#aaa;font-size:0.9em;margin-left:10px;margin-right:10px}
    .copy-btn:hover{background:rgba(255,255,255,0.2)}
    .input-container{display:flex;gap:10px;margin-top:auto}
    #model-selector{padding:10px;border:1px solid rgba(255,255,255,0.1);border-radius:8px;background:rgba(255,255,255,0.05);color:#fff}
    #user-input{flex:1;padding:10px;border:1px solid rgba(255,255,255,0.1);border-radius:8px;background:rgba(255,255,255,0.05);color:#fff}
    #send-btn{padding:10px 20px;background:linear-gradient(135deg,#007bff,#0056b3);color:#fff;border:none;border-radius:8px;cursor:pointer}
    #send-btn:hover{background:linear-gradient(135deg,#0056b3,#003d80)}
    .loading{color:#666;font-style:italic}
    .error{color:#ff0000;font-weight:bold}
.thinking-container {
    background: rgba(0,123,255,0.05);
    border-radius: 8px;
    padding: 12px;
    margin: 15px 0;
    border-left: 3px solid #007bff;
}
.think-header {
    color: #007bff;
    font-weight: 500;
    margin-bottom: 8px;
    font-size: 0.95em;
}
.think-content {
    color: rgba(255,255,255,0.8);
    font-size: 0.9em;
    line-height: 1.6;
}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <div id="main-container">
    <!-- 左侧栏 -->
    <div id="sidebar">
      <button id="sidebar-toggle">></button>
      <div id="sidebar-header">
        <h2>会话管理</h2>
      </div>
      <div id="history-list"></div>
      <button id="new-chat-btn">新建会话</button>
    </div>

    <!-- 右侧主内容区 -->
    <div id="chat-container">
      <h1>DeepSeek-R1 (夸克博客满血版)</h1>
      <div id="chat-history">
        <div class="bot-msg">你好！我是 DeepSeek，请问有什么可以帮您？</div>
      </div>
      <div class="input-container">
        <select id="model-selector">
          <option value="deepseek-reasoner">R1 模型</option>
          <option value="deepseek-chat">V3 模型</option>
        </select>
        <input type="text" id="user-input" placeholder="输入你的问题...">
        <button id="send-btn" onclick="sendMessage()">发送</button>
      </div>
    </div>
  </div>

<script>
const WORKER_URL='https://deepseek-proxy.jsxzznz.workers.dev',CORRECT_PASSWORD_HASH="fc5e038d38a57032085441e7fe7010b0";let currentChatId=null;
window.onload=function(){const e=prompt("请输入密码：");e?(CryptoJS.MD5(e).toString()!==CORRECT_PASSWORD_HASH?(alert("密码错误！"),disablePage()):loadHistoryList()):(alert("密码不能为空！"),disablePage())},disablePage=()=>{document.getElementById('user-input').disabled=document.getElementById('send-btn').disabled=!0,document.getElementById('chat-container').innerHTML+='<div class="error">密码错误，无法使用该页面。</div>'};

document.getElementById('new-chat-btn').addEventListener('click',()=>{confirm('确定要创建新会话吗？当前会话将会保存。')&&createNewChat()});

function loadHistoryList(){const e=document.getElementById('history-list'),t=JSON.parse(localStorage.getItem('deepseekChats')||'[]');e.innerHTML='',t.length?t.forEach((t,n)=>{const o=t.messages.find(e=>"user"===e.role),a=document.createElement("div");a.className="history-item",a.textContent=o?o.content.substring(0,6):"新会话",a.onclick=()=>loadChat(n),e.appendChild(a)}):(e.innerHTML='<div style="text-align:center;padding:20px;color:#aaa">暂无历史会话</div>',currentChatId=null)}

function createNewChat(){saveCurrentChat(),currentChatId=null;const e=document.getElementById('chat-history');e.innerHTML='<div class="bot-msg">你好！我是 DeepSeek，请问有什么可以帮您？</div>',e.scrollTop=e.scrollHeight}function saveCurrentChat(){const e=document.getElementById('chat-history'),t=[];e.querySelectorAll('.user-msg, .bot-msg, .thinking-container').forEach(e=>{e.classList.contains("error")||e.classList.contains("loading")||t.push({role:e.classList.contains("user-msg")?"user":"assistant",content:e.textContent.trim()})}),t.length>0&&(localStorage.setItem('deepseekChats',JSON.stringify((e=JSON.parse(localStorage.getItem('deepseekChats')||'[]'),null!==currentChatId&&e[currentChatId]?(e[currentChatId].messages=t,e):(e.push({messages:t}),currentChatId=e.length-1,e)))),loadHistoryList())}

function loadChat(e){const t=JSON.parse(localStorage.getItem('deepseekChats')||'[]');if(e>=0&&e<t.length){currentChatId=e;const n=document.getElementById('chat-history');n.innerHTML="";const o=t[e].messages;o.forEach(e=>{const t=document.createElement("div");t.className="user"===e.role?"user-msg":"bot-msg",t.innerHTML='<div class="markdown-content"></div>',t.querySelector('.markdown-content').innerHTML=marked.parse(e.content),n.appendChild(t)}),n.scrollTop=n.scrollHeight}}

async function sendMessage(){const e=document.getElementById('user-input'),t=document.getElementById('chat-history'),n=document.getElementById('send-btn'),o=document.getElementById('model-selector');if(n.disabled=!0,e.value.trim()){const a=e.value.trim(),d=document.createElement("div");d.className="user-msg",d.textContent=a,t.appendChild(d);const l=document.createElement("div");l.className="loading",l.textContent="思考中...",t.appendChild(l),t.scrollTop=t.scrollHeight;try{const d={model:o.value,messages:[{role:"user",content:a}],stream:!0},c=await fetch(WORKER_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),s=await c.body.getReader(),i=new TextDecoder;let r="",u="",m=document.createElement("div");m.className="thinking-container",m.innerHTML='<div class="think-header">🤔 模型思考过程：</div><div class="think-content"></div>',t.appendChild(m);const p=document.createElement("div");p.className="bot-msg",p.innerHTML='<div class="markdown-content"></div>',t.appendChild(p);const h=p.querySelector('.markdown-content'),g=m.querySelector('.think-content');for(;;){const{done:e,value:n}=await s.read();if(e)break;const o=i.decode(n),a=o.split('\n');for(const e of a)if(e.trim()!=="data: [DONE]")if(e.startsWith("data:"))try{const t=JSON.parse(e.slice(5)),n=t.choices[0].delta.content||"",o=t.choices[0].delta.reasoning_content||"";n&&(r+=n,h.innerHTML=marked.parse(r),t.scrollTop=t.scrollHeight),o&&(u+=o,g.innerHTML=marked.parse(u),t.scrollTop=t.scrollHeight)}catch(e){console.error("JSON解析错误:",e)}}l.remove(),m.remove();const b=document.createElement("button");b.className="copy-btn",b.innerText="复制",b.onclick=()=>{navigator.clipboard.writeText(r),b.innerText="已复制",setTimeout(()=>b.innerText="复制",2e3)},p.appendChild(b)}catch(e){document.querySelector('.loading')?.remove();const n=document.createElement("div");n.className="error",n.textContent=`错误：${e.message}`,t.appendChild(n)}finally{e.value="",n.disabled=!1,t.scrollTop=t.scrollHeight,saveCurrentChat()}}else n.disabled=!1}

document.getElementById('sidebar-toggle').addEventListener('click',function(){const e=document.getElementById('sidebar');e.classList.toggle("collapsed"),this.textContent=e.classList.contains("collapsed")?"<":">"}),window.addEventListener("resize",()=>{window.innerWidth<=768&&(document.getElementById('sidebar').classList.add("collapsed"),document.getElementById('sidebar-toggle').textContent="<")}),window.innerWidth<=768&&(document.getElementById('sidebar').classList.add("collapsed"),document.getElementById('sidebar-toggle').textContent="<");
</script>
</body>
</html>
