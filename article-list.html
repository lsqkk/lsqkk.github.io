<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/cursor.css">
    <script src="js/cursor-trail.js"></script>
    <link rel="stylesheet" href="css/article-list.css">
    <title>夸克博客 | 文章列表</title>
    <link rel="icon" href="image/logo_blue.png" type="image/png">
</head>

<body>
    <div class="header-placeholder"></div>
    <div class="header">
        <div class="header-content">
            <a href="https://lsqkk.github.io" style="color: white; text-decoration: none;">
                <h1>夸克博客</h1>
            </a>

            <div class="header-nav-container">
                <ul class="header-nav">
                    <li><a href="/">主页</a></li>
                    <li><a href="tool.html">工具</a></li>
                    <li><a href="games">游戏</a></li>
                    <li><a href="daily">日报</a></li>
                    <li><a href="qtv">视频</a></li>
                    <li><a href="https://xoyondo.com/mb/ytz1td6p1e8vfzs" target="blank">留言</a></li>
                </ul>
            </div>

            <div class="header-search">
                <input type="text" id="searchInput" placeholder="搜索博客...">
                <button onclick="searchBlog()">搜索</button>
            </div>
        </div>
    </div>

    <div class="nav">
        <ul class="mobile-nav">
            <li><a href="/">主页</a></li>
            <li><a href="tool.html">工具</a></li>
            <li><a href="games">游戏</a></li>
            <li><a href="daily">日报</a></li>
            <li><a href="qtv">视频</a></li>
            <li><a href="https://xoyondo.com/mb/ytz1td6p1e8vfzs" target="blank">留言</a></li>
        </ul>
    </div>

    <div class="posts-container">

        <div id="searchResults" class="search-results"></div>

        <div id="tagFilter" class="tag-filter"></div>

        <div id="posts"></div>

        <div class="pagination" id="pagination">
            <button class="page-btn prev-btn" onclick="prevPage()">上一页</button>
            <div class="page-numbers" id="pageNumbers"></div>
            <button class="page-btn next-btn" onclick="nextPage()">下一页</button>
        </div>
    </div>

    <div class="copyright">
        © 2024 - 2025 蓝色奇夸克 / 夸克博客 All rights reserved
    </div>

    <script>
        // 所有标签
        const allTags = ['全部', '技术', '杂谈', '社科'];
        let currentTag = '全部';
        let currentPage = 1;
        const postsPerPage = 10;
        let allPosts = [];

        // 加载文章列表
        async function loadPosts() {
            allPosts = await fetch('json/posts.json').then(r => r.json());
            // 确保所有文章都有tags数组
            allPosts.forEach(post => {
                if (!post.tags) post.tags = ['未分类'];
            });
            renderTagFilter();
            renderPosts();
            renderPagination();
        }

        // 获取当前页的文章
        function getCurrentPagePosts() {
            const filteredPosts = currentTag === '全部'
                ? allPosts
                : allPosts.filter(post => post.tags && post.tags.includes(currentTag));

            const startIndex = (currentPage - 1) * postsPerPage;
            const endIndex = startIndex + postsPerPage;
            return filteredPosts.slice(startIndex, endIndex);
        }

        // 渲染标签筛选器
        function renderTagFilter() {
            const tagFilter = document.getElementById('tagFilter');
            tagFilter.innerHTML = allTags.map(tag => `
                <button class="tag-btn ${tag === currentTag ? 'active' : ''}" 
                        onclick="filterByTag('${tag}')">
                    ${tag}
                </button>
            `).join('');
        }

        // 按标签筛选
        function filterByTag(tag) {
            currentTag = tag;
            currentPage = 1;
            renderTagFilter();
            renderPosts();
            renderPagination();
        }

        // 渲染文章列表
        function renderPosts() {
            const postsToShow = getCurrentPagePosts();

            const list = postsToShow.map(post => `
                <div class="post-item">
                    <a class="post-title" href="post.html?file=${post.file}">${post.title}</a>
                    <div class="post-date">${post.date}</div>
                    <div class="post-tags">
                        ${(post.tags || ['未分类']).map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `).join('');

            document.getElementById('posts').innerHTML = list;
        }

        // 渲染分页
        function renderPagination() {
            const filteredPosts = currentTag === '全部'
                ? allPosts
                : allPosts.filter(post => post.tags && post.tags.includes(currentTag));

            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';

            // 显示页码按钮
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            }

            // 更新上一页/下一页按钮状态
            document.querySelector('.prev-btn').disabled = currentPage === 1;
            document.querySelector('.next-btn').disabled = currentPage === totalPages;

            // 如果只有一页，隐藏分页
            document.getElementById('pagination').style.display = totalPages <= 1 ? 'none' : 'flex';
        }

        // 跳转到指定页
        function goToPage(page) {
            currentPage = page;
            renderPosts();
            renderPagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 上一页
        function prevPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }

        // 下一页
        function nextPage() {
            const filteredPosts = currentTag === '全部'
                ? allPosts
                : allPosts.filter(post => post.tags && post.tags.includes(currentTag));
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);

            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }

        // 搜索博客功能
        async function searchBlog() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm.trim() === '') {
                document.getElementById('searchResults').style.display = 'none';
                document.getElementById('tagFilter').style.display = 'flex';
                document.getElementById('posts').style.display = 'block';
                document.getElementById('pagination').style.display = 'flex';
                return;
            }

            const searchResults = allPosts.filter(post =>
                post.title.toLowerCase().includes(searchTerm) ||
                (post.tags && post.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );

            const searchResultsContainer = document.getElementById('searchResults');
            searchResultsContainer.innerHTML = '';

            if (searchResults.length > 0) {
                searchResults.forEach(post => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.innerHTML = `
                        <a class="post-title" href="post.html?file=${post.file}">${post.title}</a>
                        <div class="post-date">${post.date}</div>
                        <div class="post-tags">
                            ${(post.tags || ['未分类']).map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                        </div>
                    `;
                    searchResultsContainer.appendChild(resultItem);
                });
            } else {
                searchResultsContainer.innerHTML = '<div style="color: #666; text-align: center;">未找到相关文章</div>';
            }

            document.getElementById('searchResults').style.display = 'block';
            document.getElementById('tagFilter').style.display = 'none';
            document.getElementById('posts').style.display = 'none';
            document.getElementById('pagination').style.display = 'none';
        }

        // 初始化加载
        document.addEventListener('DOMContentLoaded', loadPosts);

        // 监听搜索输入框的Enter键
        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                searchBlog();
            }
        });
    </script>
</body>

</html>